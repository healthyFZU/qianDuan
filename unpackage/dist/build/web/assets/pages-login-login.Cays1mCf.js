import{T as a,R as e,v as s,b as o,U as l,t,H as n,w as r,n as c,V as u,I as i,l as p,f as d,a as m,e as v,d as g}from"./index-DD8SDI5w.js";import{_ as f}from"./login.CaPDJO-K.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=k({__name:"login",setup(k){const _=a(),h=e("");e("");const w=e(""),y=e(""),j=e(""),V=e({avatar:"",nickname:""});function b(){c({url:"/pages/register/register"})}function I(){c({url:"/pages/forgetpwd/forgetpwd"})}async function T(){try{const a=await fetch("http://129.204.151.245:5001/user/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNum:w.value,password:y.value})}),e=await a.json();console.log(e),a.ok&&e.access_token?(alert("登录成功"),_.commit("setUserId",e.userId),_.commit("setAccessToken",e.access_token),h.value=e.userId,await(async()=>{try{const a=await fetch(`http://129.204.151.245:5001/user/message/${h.value}`,{method:"GET"}),e=await a.json();console.log(e),e.avatar_url?V.value.avatar=e.avatar_url:V.value.avatar="/pages/images/logo-black.jpg",V.value.nickname=e.nickname,_.commit("setAvatar_url",V.value.avatar),_.commit("setNickname",V.value.nickname)}catch(a){console.error("请求用户资料失败:",a),V.value.avatar="/pages/images/logo-black.jpg"}})(),u({url:"/pages/home/home"})):j.value=e.message||"登录失败，请检查您的手机号和密码"}catch(a){console.error("登录请求失败:",a),j.value="登录请求失败，请稍后再试"}}return(a,e)=>{const c=g,u=i,k=p,_=d;return m(),s("div",{class:"login-container"},[o(c,{class:"logo",src:f,mode:"aspectFit"}),l("div",{class:"input-group"},[l("span",{class:"icon"},"📱"),o(u,{type:"text",modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=a=>w.value=a),placeholder:"请输入您的手机号"},null,8,["modelValue"])]),l("div",{class:"input-group"},[l("span",{class:"icon"},"🔒"),o(u,{type:"password",modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),placeholder:"请输入您的密码"},null,8,["modelValue"])]),j.value?(m(),s("div",{key:0,class:"error-message"},t(j.value),1)):n("",!0),o(k,{class:"login-button",onClick:T},{default:r((()=>[v("登录")])),_:1}),l("div",{class:"footer-links"},[o(_,{onClick:b,class:"register-link"},{default:r((()=>[v("注册账号")])),_:1}),o(_,{onClick:I,class:"forgot-password-link"},{default:r((()=>[v("忘记密码")])),_:1})])])}}},[["__scopeId","data-v-ea43d320"]]);export{_ as default};
