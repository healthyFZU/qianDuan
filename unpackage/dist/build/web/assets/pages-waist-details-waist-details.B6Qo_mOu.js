import{T as e,v as s,U as t,F as i,x as a,b as n,w as o,H as r,l as d,a as l,e as c,t as m,f as h,z as u,I as p}from"./index-DD8SDI5w.js";import{i as y}from"./index.Bj8O3GTo.js";import{_ as f}from"./background.9mxQRA6f.js";import{_ as g}from"./_plugin-vue_export-helper.BCo6x5W8.js";const v=g({data:()=>({dimensions:[{name:"腰围",value:0,history:[],dates:[]},{name:"大腿",value:0,history:[],dates:[]},{name:"小腿",value:0,history:[],dates:[]},{name:"臀围",value:0,history:[],dates:[]},{name:"胸围",value:0,history:[],dates:[]},{name:"手臂",value:0,history:[],dates:[]}],selectedDimension:"腰围",chart:null,userId:null,accessToken:null,isModalVisible:!1,editingDimensions:{}}),setup:()=>({store:e()}),mounted(){this.userId=this.$store.state.userId,this.accessToken=this.$store.state.access_token,this.userId&&this.accessToken?this.loadMeasurements():alert("请先登录！"),this.initChart()},methods:{selectDimension(e){this.selectedDimension=e,this.updateChart()},initChart(){const e=document.getElementById("dimensionChart");e?(this.chart=y(e),this.updateChart()):console.error("图表容器未找到")},updateChart(){if(!this.chart)return;const e=this.dimensions.find((e=>e.name===this.selectedDimension));if(!e)return void console.error("未找到选定的维度数据：",this.selectedDimension);const s={title:{text:`${e.name} 变化趋势`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:e.dates},yAxis:{type:"value",name:"围度 (cm)"},series:[{name:e.name,type:"line",data:e.history}]};this.chart.setOption(s)},initChart(){this.chart=y(document.getElementById("dimensionChart"))},async loadMeasurements(){try{const e=await fetch(`http://129.204.151.245:5001/user/${this.userId}/measurements`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.accessToken}`}});if(e.ok){const s=await e.json();if(!s||0===s.length)return console.warn("无测量记录"),void(this.measurementId=null);const t=s[s.length-1];this.measurementId=t.measurement_id,this.dimensions.forEach((e=>{const s=this.getDimensionKey(e.name);if(s&&t[s]){const i=Object.keys(t[s]).pop();e.value=t[s][i]||0}})),this.dimensions.forEach((e=>{e.history=[],e.dates=[]})),s.forEach((e=>{this.dimensions.forEach((s=>{const t=this.getDimensionKey(s.name);if(t&&e[t])for(let i in e[t])s.history.push(e[t][i]),s.dates.push(i)}))})),this.updateChart()}else console.error("加载围度记录失败，状态码：",e.status)}catch(e){console.error("加载围度记录失败：",e)}},updateChart(){if(!this.chart)return;const e=this.dimensions.find((e=>e.name===this.selectedDimension));if(!e)return void console.error("未找到选定的维度数据：",this.selectedDimension);const s={title:{text:`${e.name} 变化趋势`,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:e.dates},yAxis:{type:"value",name:"围度 (cm)"},series:[{name:e.name,type:"line",data:e.history}]};this.chart.setOption(s)},getDimensionKey:e=>({"腰围":"waist","大腿":"thigh","小腿":"calf","胸围":"bust","臀围":"hips","手臂":"arm"}[e]),async saveEdit(){this.measurementId||await this.createMeasurement();const e={...this.editingDimensions},s={waist:e["腰围"],thigh:e["大腿"],calf:e["小腿"],hips:e["臀围"],bust:e["胸围"],arm:e["手臂"],dates:[this.formatDate(new Date)]};try{const e=await fetch(`http://129.204.151.245:5001/user/${this.userId}/measurements`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.accessToken}`},body:JSON.stringify(s)});if(e.ok){const s=await e.json();alert("记录保存成功！"),this.measurementId=s.measurement_id,this.isModalVisible=!1,await this.loadMeasurements()}else console.error("保存记录失败，状态码：",e.status)}catch(t){console.error("保存记录失败：",t)}},openEditModal(){this.isModalVisible=!0,this.editingDimensions=this.dimensions.reduce(((e,s)=>(e[s.name]=s.value,e)),{})},cancelEdit(){this.isModalVisible=!1},getDimensionKey:e=>({"腰围":"waist","大腿":"thigh","小腿":"calf","胸围":"bust","臀围":"hips","手臂":"arm"}[e]),formatDate:e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}},[["render",function(e,y,g,v,k,C){const D=h,b=d,x=u,I=p;return l(),s("div",{class:"dimension-record"},[t("div",{class:"main-image"},[t("img",{src:f,alt:"logo",class:"background-image"})]),t("div",{class:"header"}),t("div",{class:"dimension-cards"},[(l(!0),s(i,null,a(k.dimensions,((e,i)=>(l(),s("div",{key:i,class:"dimension-card",onClick:s=>C.selectDimension(e.name)},[n(D,{class:"text"},{default:o((()=>[c(m(e.name),1)])),_:2},1024),t("p",null,m(e.value)+" cm",1)],8,["onClick"])))),128))]),t("div",{class:"chart-container",id:"dimensionChart"}),t("div",{class:"record-section"},[n(b,{onClick:C.openEditModal},{default:o((()=>[c("修改记录")])),_:1},8,["onClick"])]),k.isModalVisible?(l(),s("div",{key:0,class:"modal"},[t("div",{class:"modal-content"},[t("h3",null,"修改围度记录"),(l(!0),s(i,null,a(k.dimensions,(e=>(l(),s("div",{key:e.name,class:"dimension-input"},[n(x,{for:e.name},{default:o((()=>[c(m(e.name)+":",1)])),_:2},1032,["for"]),n(I,{modelValue:k.editingDimensions[e.name],"onUpdate:modelValue":s=>k.editingDimensions[e.name]=s,placeholder:e.name,type:"number"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])))),128)),t("div",{class:"modal-actions"},[n(b,{class:"b1",onClick:C.cancelEdit},{default:o((()=>[c("取消")])),_:1},8,["onClick"]),n(b,{class:"b1",onClick:C.saveEdit},{default:o((()=>[c("确定")])),_:1},8,["onClick"])])])])):r("",!0)])}],["__scopeId","data-v-886b8b11"]]);export{v as default};
