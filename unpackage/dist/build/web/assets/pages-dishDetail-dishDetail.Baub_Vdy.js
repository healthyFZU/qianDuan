import{_ as e,c as s,w as a,i as t,a as r,U as i,b as l,e as n,t as d,v as o,x as c,F as h,d as u,f}from"./index-DD8SDI5w.js";import{_ as g}from"./background.9mxQRA6f.js";import{_ as m}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=m({data:()=>({dishId:"",dish:{dish_name:"",dish_image:"",nutrition:[],ingredients:[],allergens:[],detail:"",score:""},merchantId:"",merchant:{Merchant_name:"",address:"",logo:"",menu:[],created_at:"",updated_at:""},error:""}),onLoad(e){this.dishId=e.dishId||"",this.fetchDishData(),this.merchantId=e.merchantId||"",this.merchantId&&this.fetchMerchantData()},methods:{fetchDishData(){if(!this.dishId)return console.error("未提供有效的 dishId"),void(this.error="无效的菜品 ID");console.log("Fetching data for dishId:",this.dishId),e({url:`http://129.204.151.245:5001/dishes/${this.dishId}`,method:"GET",success:e=>{if(console.log("API response:",e.data),200===e.statusCode&&e.data){const{nutrition:s,ingredients:a,allergens:t,...r}=e.data;this.dish={...r,nutrition:this.validateArrayField(s,"nutrition"),ingredients:this.validateArrayField(a,"ingredients"),allergens:this.validateArrayField(t,"allergens")},console.log("Processed dish data:",this.dish)}else this.error="获取菜品数据失败",console.error("获取菜品数据失败:",e)},fail:e=>{this.error="请求菜品数据失败",console.error("请求菜品数据失败:",e)}})},fetchMerchantData(){if(!this.merchantId)return console.error("未提供有效的 merchantId"),void(this.error="无效的商家 ID");console.log("Fetching data for merchantId:",this.merchantId),e({url:`http://129.204.151.245:5001/merchants/${this.merchantId}`,method:"GET",success:e=>{console.log("API response for merchant:",e.data),200===e.statusCode&&e.data?(this.merchant=e.data,console.log("Processed merchant data:",this.merchant)):(this.error="获取商家数据失败",console.error("获取商家数据失败:",e))},fail:e=>{this.error="请求商家数据失败",console.error("请求商家数据失败:",e)}})},validateArrayField(e,s){try{if(Array.isArray(e))return e;if("string"==typeof e&&e.trim().startsWith("["))return JSON.parse(e);if("string"==typeof e)return e.split(",").map((e=>e.trim())).filter((e=>e))}catch(a){console.error(`解析 ${s} 数据失败:`,a)}return[]}}},[["render",function(e,m,_,p,y,I){const k=u,v=f,A=t;return r(),s(A,{class:"dish-detail"},{default:a((()=>[i("div",{class:"main-image"},[i("img",{src:g,alt:"logo",class:"background-image2"})]),l(k,{class:"background-image",src:y.dish.dish_image||"/pages/images/捂嘴.png",mode:"aspectFill"},null,8,["src"]),l(A,{class:"info-box"},{default:a((()=>[l(A,{class:"info-row"},{default:a((()=>[l(v,{class:"dish-name"},{default:a((()=>[n(d(y.dish.dish_name||"未命名菜品"),1)])),_:1}),l(v,{class:"dish-rating"},{default:a((()=>[n("评分: "+d(y.dish.score||"暂无评分"),1)])),_:1})])),_:1}),l(v,{class:"dish-description"},{default:a((()=>[n(d(y.dish.detail||"暂无描述信息"),1)])),_:1})])),_:1}),l(A,{class:"nutrition-info"},{default:a((()=>[l(v,{class:"section-title"},{default:a((()=>[n("营养信息")])),_:1}),Array.isArray(y.dish.nutrition)&&y.dish.nutrition.length?(r(),s(A,{key:0,class:"nutritions-tags"},{default:a((()=>[(r(!0),o(h,null,c(y.dish.nutrition,(e=>(r(),s(A,{class:"nutrition-tag",key:e},{default:a((()=>[l(v,null,{default:a((()=>[n(d(e),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(r(),s(A,{key:1,class:"no-data"},{default:a((()=>[n("暂无营养信息")])),_:1}))])),_:1}),l(A,{class:"ingredients-info"},{default:a((()=>[l(v,{class:"section-title"},{default:a((()=>[n("菜品食材")])),_:1}),y.dish.ingredients&&y.dish.ingredients.length?(r(),s(A,{key:0,class:"ingredients-tags"},{default:a((()=>[(r(!0),o(h,null,c(y.dish.ingredients,((e,t)=>(r(),s(A,{class:"ingredient-item",key:t},{default:a((()=>[l(v,null,{default:a((()=>[n(d(e),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(r(),s(A,{key:1,class:"no-data"},{default:a((()=>[n("暂无菜品食材信息")])),_:1}))])),_:1}),l(A,{class:"allergens-info"},{default:a((()=>[l(v,{class:"section-title"},{default:a((()=>[n("过敏原")])),_:1}),y.dish.allergens&&y.dish.allergens.length?(r(),s(A,{key:0,class:"allergen-tags"},{default:a((()=>[(r(!0),o(h,null,c(y.dish.allergens,((e,t)=>(r(),s(A,{class:"allergen-item",key:t},{default:a((()=>[l(v,null,{default:a((()=>[n(d(e),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(r(),s(A,{key:1,class:"no-data"},{default:a((()=>[n("暂无过敏原信息")])),_:1}))])),_:1}),l(A,{class:"related-restaurants"},{default:a((()=>[l(v,{class:"section-title"},{default:a((()=>[n("相关店铺信息")])),_:1}),y.merchant.Merchant_name?(r(),s(A,{key:0,class:"merchant-card"},{default:a((()=>[l(k,{src:y.merchant.logo,alt:"商家 Logo",class:"merchant-logo"},null,8,["src"]),l(A,{class:"merchant-info"},{default:a((()=>[l(v,{class:"merchant-name"},{default:a((()=>[n(d(y.merchant.Merchant_name),1)])),_:1}),l(v,{class:"merchant-address"},{default:a((()=>[n(d(y.merchant.address),1)])),_:1})])),_:1})])),_:1})):(r(),s(A,{key:1,class:"no-data"},{default:a((()=>[n("暂无店铺推荐")])),_:1}))])),_:1})])),_:1})}],["__scopeId","data-v-dced37aa"]]);export{_ as default};
