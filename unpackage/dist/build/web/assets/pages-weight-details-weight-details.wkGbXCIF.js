import{T as t,c as e,w as i,i as a,a as s,U as r,b as o,e as h,f as n,I as l,l as c}from"./index-DD8SDI5w.js";import{i as g}from"./index.Bj8O3GTo.js";import{_ as d}from"./background.9mxQRA6f.js";import{_ as u}from"./_plugin-vue_export-helper.BCo6x5W8.js";const p=u({data:()=>({initialWeight:null,targetWeight:null,newWeight:"",weightRecords:[],weightDates:[],userId:null,accessToken:null}),setup:()=>({store:t()}),computed:{progressPercentage(){if(this.initialWeight&&this.targetWeight){const t=this.weightRecords[this.weightRecords.length-1]||this.initialWeight,e=(this.initialWeight-t)/(this.initialWeight-this.targetWeight)*100;return Math.max(0,Math.min(e.toFixed(2),100))}return 0}},mounted(){this.userId=this.$store.state.userId,this.accessToken=this.$store.state.access_token,this.userId&&this.accessToken?(this.initChart(),this.fetchWeightRecords()):alert("请先登录！")},methods:{async addWeight(){if(!this.newWeight)return void alert("请输入新体重！");const t={weight:Number(this.newWeight),pre_over_time:this.formatDate(new Date)};console.log("111111",this.userId);try{const e=await fetch(`http://129.204.151.245:5001/user/${this.userId}/body-info`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.accessToken}`},body:JSON.stringify({weight:t.weight,pre_over_time:t.pre_over_time})});if(e.ok){await e.json();this.weightRecords.push(t.weight),this.weightDates.push(t.pre_over_time),this.newWeight="",this.updateChart(),alert("体重记录成功！")}else alert("保存体重记录失败，请稍后重试！")}catch(e){console.error("保存失败:",e),alert("保存体重记录失败，请检查网络连接！")}},async fetchWeightRecords(){try{const t=await fetch(`http://129.204.151.245:5001/user/${this.userId}/body-info`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.accessToken}`}});if(t.ok){const e=await t.json();this.weightRecords=[e.weight],this.weightDates=[e.pre_over_time],this.initialWeight||(this.initialWeight=e.weight),this.targetWeight=e.weight_target,this.updateChart()}else alert("加载体重记录失败，请稍后重试！")}catch(t){t.response&&404===t.response.status?(console.log("未找到体重记录，正在创建默认记录..."),await this.createInitialWeightRecord()):(console.error("加载体重记录失败:",t),alert("无法加载历史体重记录，请稍后重试！"))}},async createInitialWeightRecord(){try{const t=70,e=65,i=this.formatDate(new Date);(await fetch(`http://129.204.151.245:5001/user/${this.userId}/body-info`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.accessToken}`},body:JSON.stringify({weight:t,weight_target:e,pre_over_time:i})})).ok?(console.log("默认体重记录创建成功！"),this.initialWeight=t,this.targetWeight=e,this.weightRecords=[t],this.weightDates=[i],this.updateChart()):alert("无法创建默认体重记录，请稍后重试！")}catch(t){console.error("创建默认体重记录失败:",t),alert("创建默认体重记录失败，请检查网络连接！")}},initChart(){const t=document.getElementById("weightChart");t?(this.chart=g(t),this.updateChart()):console.error("图表容器未找到")},updateChart(){if(!this.chart)return;const t={title:{text:"体重变化趋势"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:this.weightDates},yAxis:{type:"value"},series:[{name:"体重",data:this.weightRecords,type:"line",smooth:!0,label:{show:!0,position:"top"},itemStyle:{color:"#50cc8e"}}]};this.chart.setOption(t)},formatDate:t=>`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}},[["render",function(t,g,u,p,m,w){const f=n,_=l,W=a,y=c;return s(),e(W,{class:"container"},{default:i((()=>[r("div",{class:"main-image"},[r("img",{src:d,alt:"logo",class:"background-image"})]),o(W,{class:"settings"},{default:i((()=>[o(W,null,{default:i((()=>[o(f,null,{default:i((()=>[h("初始体重 (kg):")])),_:1}),o(_,{type:"number",modelValue:m.initialWeight,"onUpdate:modelValue":g[0]||(g[0]=t=>m.initialWeight=t),placeholder:"输入初始体重"},null,8,["modelValue"])])),_:1}),o(W,null,{default:i((()=>[o(f,null,{default:i((()=>[h("目标体重 (kg):")])),_:1}),o(_,{type:"number",modelValue:m.targetWeight,"onUpdate:modelValue":g[1]||(g[1]=t=>m.targetWeight=t),placeholder:"输入目标体重"},null,8,["modelValue"])])),_:1})])),_:1}),o(W,{class:"record-weight"},{default:i((()=>[o(f,null,{default:i((()=>[h("记录新体重 (kg):")])),_:1}),o(_,{type:"number",modelValue:m.newWeight,"onUpdate:modelValue":g[2]||(g[2]=t=>m.newWeight=t),placeholder:"输入体重"},null,8,["modelValue"]),o(y,{onClick:w.addWeight},{default:i((()=>[h("记录")])),_:1},8,["onClick"])])),_:1}),r("div",{id:"weightChart",class:"chart-container"})])),_:1})}],["__scopeId","data-v-18cb87ea"]]);export{p as default};
