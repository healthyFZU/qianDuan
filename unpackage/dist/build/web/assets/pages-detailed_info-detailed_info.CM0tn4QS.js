import{T as e,a2 as a,W as l,v as t,U as o,b as s,w as r,a3 as u,a4 as n,a5 as d,a6 as i,z as c,l as p,I as m,a as h,e as g}from"./index-DD8SDI5w.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=V({__name:"detailed_info",setup(V){const _=e(),y=a({avatar:"",nickname:"",gender:"男",birthYear:"",birthMonth:"",birthDay:"",height:0,weight:0,blood_sugar:"",blood_pressure:"",recent_medications:"",allergy:"",medicalHistory:"",other:"",specialPeriod:"否",target:"",targetWeight:0,targetYear:"",targetMonth:"",targetDay:"",progress:"",specialCondition:"无"}),b=l((()=>_.state.userId)),v=l((()=>_.state.access_token));console.log(v.value,b.value);(async()=>{try{const e=await fetch(`http://129.204.151.245:5001/user/message/${b.value}`,{method:"GET"}),a=await e.json();a.avatar_url?y.avatar=a.avatar_url:y.avatar="/pages/images/logo-black.jpg",y.nickname=a.nickname}catch(e){console.error("请求用户资料失败:",e),y.avatar="/pages/images/logo-black.jpg"}})();const f=()=>{d({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:async e=>{const a=e.tempFilePaths[0];try{const e=await i({url:`http://129.204.151.245:5001/upload/${b.value}`,filePath:a,name:"file",header:{Authorization:`Bearer ${v.value}`}}),l=JSON.parse(e.data);"File uploaded successfully"===l.message?(y.avatar=l.url,alert("头像上传成功！")):alert(`头像上传失败：${l.error||l.message}`)}catch(l){console.error("上传头像失败：",l),alert("头像上传失败，请检查网络连接！")}},fail:e=>{console.error("选择图片失败：",e),alert("图片选择失败！")}})},U=async e=>{const a={basic:"http://129.204.151.245:5001/user/update",health:`http://129.204.151.245:5001/user/${b.value}/health-info`,target:`http://129.204.151.245:5001/user/${b.value}/body-info`};let l={};"basic"===e?l={nickname:y.nickname,avatar_url:y.avatar}:"health"===e?l={blood_sugar:y.blood_sugar,blood_pressure:y.blood_pressure,recent_medications:y.recent_medications,allergens:y.allergy,past_medical_history:y.medicalHistory,other:y.other}:"target"===e&&(l={birthday:`${y.birthYear}-${y.birthMonth}-${y.birthDay}`,sex:y.gender,height:y.height,weight:y.weight,special_time:y.specialPeriod,weight_target:y.targetWeight,pre_over_time:`${y.targetYear}-${y.targetMonth}-${y.targetDay}`,target:y.target,stage:y.progress,special_circumstances:y.specialCondition});try{console.log(b,v);const t=await fetch(a[e],{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v.value}`},body:JSON.stringify(l)});console.log(l);const o=await t.json();t.ok?alert(("basic"===e?"基本信息":"health"===e?"健康信息":"目标信息")+"保存成功！"):alert(`保存失败：${o.message}`)}catch(t){console.error(`保存${e}时发生错误：`,t),alert(`保存${e}失败，请检查网络连接！`)}};return(e,a)=>{const l=c,d=p,i=m;return h(),t("div",{class:"profile-card"},[o("h4",{class:"title"},"请完善个人资料卡"),o("h4",{class:"t1"},"基本信息"),o("div",{class:"avatar-section"},[s(l,null,{default:r((()=>[g("切换头像")])),_:1}),o("img",{class:"avatar",src:y.avatar||"/pages/images/logo-black.jpg",alt:"Avatar"},null,8,["src"]),s(d,{class:"upload-button",onClick:f},{default:r((()=>[g("+")])),_:1})]),o("div",{class:"form-section"},[s(l,null,{default:r((()=>[g("昵称")])),_:1}),s(i,{class:"input",type:"text",modelValue:y.nickname,"onUpdate:modelValue":a[0]||(a[0]=e=>y.nickname=e),placeholder:"请输入"},null,8,["modelValue"]),s(d,{class:"save-button",onClick:a[1]||(a[1]=e=>U("basic"))},{default:r((()=>[g("保存账号信息")])),_:1})]),o("h4",{class:"t2"},"健康信息"),o("div",{class:"form-section"},[s(l,null,{default:r((()=>[g("血糖")])),_:1}),s(i,{class:"input",type:"text",modelValue:y.blood_sugar,"onUpdate:modelValue":a[2]||(a[2]=e=>y.blood_sugar=e),placeholder:"请输入(例:3.9~6.1)"},null,8,["modelValue"]),s(l,null,{default:r((()=>[g("血压")])),_:1}),s(i,{class:"input",type:"text",modelValue:y.blood_pressure,"onUpdate:modelValue":a[3]||(a[3]=e=>y.blood_pressure=e),placeholder:"请输入(例:140/90)"},null,8,["modelValue"]),s(l,null,{default:r((()=>[g("过敏源")])),_:1}),s(i,{class:"input",type:"text",modelValue:y.allergy,"onUpdate:modelValue":a[4]||(a[4]=e=>y.allergy=e),placeholder:"请输入"},null,8,["modelValue"]),s(l,null,{default:r((()=>[g("近期用药记录")])),_:1}),s(i,{class:"input",type:"text",modelValue:y.recent_medications,"onUpdate:modelValue":a[5]||(a[5]=e=>y.recent_medications=e),placeholder:"请输入"},null,8,["modelValue"]),s(l,null,{default:r((()=>[g("既往病史")])),_:1}),s(i,{class:"input",type:"text",modelValue:y.medicalHistory,"onUpdate:modelValue":a[6]||(a[6]=e=>y.medicalHistory=e),placeholder:"请输入"},null,8,["modelValue"]),s(l,null,{default:r((()=>[g("其他")])),_:1}),s(i,{class:"input",type:"text",modelValue:y.other,"onUpdate:modelValue":a[7]||(a[7]=e=>y.other=e),placeholder:"请输入"},null,8,["modelValue"]),s(d,{class:"save-button",onClick:a[8]||(a[8]=e=>U("health"))},{default:r((()=>[g("保存健康信息")])),_:1})]),o("h4",{class:"t3"},"目标及身体信息"),o("div",{class:"form-section"},[s(l,null,{default:r((()=>[g("性别")])),_:1}),u(o("select",{"onUpdate:modelValue":a[9]||(a[9]=e=>y.gender=e),class:"input2"},[o("option",{value:"男"},"男"),o("option",{value:"女"},"女")],512),[[n,y.gender]]),s(l,null,{default:r((()=>[g("生日")])),_:1}),o("div",{class:"date-input"},[s(i,{type:"number",modelValue:y.birthYear,"onUpdate:modelValue":a[10]||(a[10]=e=>y.birthYear=e),placeholder:"年"},null,8,["modelValue"]),s(i,{type:"number",modelValue:y.birthMonth,"onUpdate:modelValue":a[11]||(a[11]=e=>y.birthMonth=e),placeholder:"月"},null,8,["modelValue"]),s(i,{type:"number",modelValue:y.birthDay,"onUpdate:modelValue":a[12]||(a[12]=e=>y.birthDay=e),placeholder:"日"},null,8,["modelValue"])]),s(l,null,{default:r((()=>[g("身高")])),_:1}),s(i,{class:"input",type:"number",modelValue:y.height,"onUpdate:modelValue":a[13]||(a[13]=e=>y.height=e),placeholder:"请输入"},null,8,["modelValue"]),s(l,null,{default:r((()=>[g("体重")])),_:1}),s(i,{class:"input",type:"number",modelValue:y.weight,"onUpdate:modelValue":a[14]||(a[14]=e=>y.weight=e),placeholder:"请输入"},null,8,["modelValue"]),s(l,null,{default:r((()=>[g("特殊时期")])),_:1}),u(o("select",{class:"input2","onUpdate:modelValue":a[15]||(a[15]=e=>y.specialPeriod=e)},[o("option",{value:"是"},"是"),o("option",{value:"否"},"否")],512),[[n,y.specialPeriod]]),s(l,null,{default:r((()=>[g("管理目标")])),_:1}),s(i,{class:"input",type:"text",modelValue:y.target,"onUpdate:modelValue":a[16]||(a[16]=e=>y.target=e),placeholder:"请输入"},null,8,["modelValue"]),s(l,null,{default:r((()=>[g("目标体重")])),_:1}),s(i,{class:"input",type:"number",modelValue:y.targetWeight,"onUpdate:modelValue":a[17]||(a[17]=e=>y.targetWeight=e),placeholder:"请输入"},null,8,["modelValue"]),s(l,null,{default:r((()=>[g("阶段进度")])),_:1}),s(i,{class:"input",type:"text",modelValue:y.progress,"onUpdate:modelValue":a[18]||(a[18]=e=>y.progress=e),placeholder:"请输入"},null,8,["modelValue"]),s(l,null,{default:r((()=>[g("预计达成时间")])),_:1}),o("div",{class:"date-input"},[s(i,{type:"number",modelValue:y.targetYear,"onUpdate:modelValue":a[19]||(a[19]=e=>y.targetYear=e),placeholder:"年"},null,8,["modelValue"]),s(i,{type:"number",modelValue:y.targetMonth,"onUpdate:modelValue":a[20]||(a[20]=e=>y.targetMonth=e),placeholder:"月"},null,8,["modelValue"]),s(i,{type:"number",modelValue:y.targetDay,"onUpdate:modelValue":a[21]||(a[21]=e=>y.targetDay=e),placeholder:"日"},null,8,["modelValue"])]),s(l,null,{default:r((()=>[g("特殊情况")])),_:1}),u(o("select",{class:"input2","onUpdate:modelValue":a[22]||(a[22]=e=>y.specialCondition=e)},[o("option",{value:"有"},"有"),o("option",{value:"无"},"无")],512),[[n,y.specialCondition]]),s(d,{class:"save-button",onClick:a[23]||(a[23]=e=>U("target"))},{default:r((()=>[g("保存目标及身体信息")])),_:1})])])}}},[["__scopeId","data-v-1a9409e3"]]);export{_ as default};
